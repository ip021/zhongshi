<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>åŒ»ç–—å™¨æ¢°ä¸­è¯•ç®¡ç†å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        .page {
            min-height: 100vh;
            background: white;
        }
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #0077b6;
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .footer-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #eee;
            display: flex;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            font-size: 12px;
            color: #666;
        }
        .nav-item.active {
            color: #0077b6;
        }
        .card {
            background: white;
            margin: 12px;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .btn {
            background: #0077b6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            margin: 8px 0;
        }
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        .task-card {
            background: white;
            margin: 8px 12px;
            border-radius: 8px;
            padding: 16px;
            border-left: 4px solid #0077b6;
        }
        .milestone-item {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        .milestone-item:last-child {
            border-bottom: none;
        }
        .milestone-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 12px;
        }
        .status-completed { background: #4caf50; }
        .status-in-progress { background: #ff9800; }
        .status-pending { background: #9e9e9e; }
        .file-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-icon {
            width: 40px;
            height: 40px;
            background: #e3f2fd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        .param-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 8px 0;
        }
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 24px;
            z-index: 1000;
            display: none;
        }
        .signature-canvas {
            width: 100%;
            height: 200px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
            margin: 16px 0;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .tab-header {
            display: flex;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }
        .tab-item {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tab-item.active {
            border-bottom: 2px solid #0077b6;
            color: #0077b6;
        }
        .login-form {
            margin-top: 20px;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .quick-entry-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .quick-entry-item {
            background: white;
            margin: 8px;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .quick-entry-item .icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .quick-entry-item .text {
            font-size: 14px;
        }
        .disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .project-item {
            padding: 16px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .project-item:last-child {
            border-bottom: none;
        }
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .project-name {
            font-weight: bold;
            font-size: 16px;
        }
        .project-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: white;
        }
        .status-progress { background: #ff9800; }
        .status-completed { background: #4caf50; }
        .status-pending { background: #9e9e9e; }
        .project-details {
            margin-top: 12px;
            padding-left: 16px;
            border-left: 2px solid #e0e0e0;
        }
        .chat-item {
            margin: 8px 0;
            padding: 8px;
            border-left: 3px solid #e0e0e0;
        }
        .chat-sender {
            font-weight: bold;
            color: #0077b6;
        }
        .chat-time {
            font-size: 12px;
            color: #999;
        }
        .message-input {
            display: flex;
            margin-top: 16px;
        }
        .message-input input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px 0 0 8px;
        }
        .message-input button {
            border-radius: 0 8px 8px 0;
            padding: 12px 16px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ç™»å½•é¡µé¢ -->
        <div v-if="currentPage === 'login'" class="page">
            <div class="login-container">
                <h2 style="text-align: center; margin-bottom: 20px;">åŒ»ç–—å™¨æ¢°ä¸­è¯•ç®¡ç†å¹³å°</h2>
                
                <div class="tab-header">
                    <div class="tab-item" :class="{ active: loginTab === 'client' }" @click="loginTab = 'client'">
                        å®¢æˆ·ç™»å½•
                    </div>
                    <div class="tab-item" :class="{ active: loginTab === 'internal' }" @click="loginTab = 'internal'">
                        å¹³å°ç™»å½•
                    </div>
                </div>
                
                <div class="login-form">
                    <div class="form-group">
                        <label>ç”¨æˆ·å</label>
                        <input type="text" v-model="loginForm.username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                        <div style="font-size: 12px; color: #999; margin-top: 4px;">
                            <span v-if="loginTab === 'client'">é¢„å¡«: customer001</span>
                            <span v-else>é¢„å¡«: manager001</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>å¯†ç </label>
                        <input type="password" v-model="loginForm.password" placeholder="è¯·è¾“å…¥å¯†ç ">
                        <div style="font-size: 12px; color: #999; margin-top: 4px;">
                            é¢„å¡«: 123456
                        </div>
                    </div>
                    
                    <div v-if="loginTab === 'internal'" class="form-group">
                        <label>é€‰æ‹©è§’è‰²</label>
                        <select v-model="loginForm.role" class="param-input">
                            <option value="">è¯·é€‰æ‹©è§’è‰²</option>
                            <option value="é¡¹ç›®ç»ç†">é¡¹ç›®ç»ç†</option>
                            <option value="ä¸­è¯•å·¥ç¨‹å¸ˆ">ä¸­è¯•å·¥ç¨‹å¸ˆ</option>
                            <option value="æ£€æµ‹å·¥ç¨‹å¸ˆ">æ£€æµ‹å·¥ç¨‹å¸ˆ</option>
                            <option value="è´¨é‡å®¡æ ¸å‘˜">è´¨é‡å®¡æ ¸å‘˜</option>
                            <option value="å¹³å°ç®¡ç†å‘˜">å¹³å°ç®¡ç†å‘˜</option>
                        </select>
                    </div>
                    
                    <button @click="login" class="btn">ç™»å½•</button>
                </div>
            </div>
        </div>

        <!-- é¦–é¡µ -->
        <div v-if="currentPage === 'home'" class="page">
            <div class="header">
                <div>ä¸­è¯•å¹³å°</div>
                <div>{{ currentUser.role }}</div>
            </div>
            
            <div style="padding: 16px;">
                <h2>ğŸ‘‹ {{ currentUser.name }}ï¼Œä»Šå¤©æœ‰{{ todoCount }}ä¸ªæ–°è¿›å±•ï¼</h2>
                
                <!-- å¿«æ·å…¥å£ -->
                <div class="quick-entry-grid">
                    <div v-for="entry in quickEntries" :key="entry.id" 
                         :class="['quick-entry-item', { disabled: !entry.enabled }]"
                         @click="entry.enabled ? navigateTo(entry.page) : showNoPermission()">
                        <div class="icon">{{ entry.icon }}</div>
                        <div class="text">{{ entry.text }}</div>
                    </div>
                </div>
                
                <!-- é¡¹ç›®åŠ¨æ€ -->
                <div class="card">
                    <h3>ğŸ“… æœ€è¿‘é¡¹ç›®åŠ¨æ€</h3>
                    <div v-for="update in projectUpdates" :key="update.id" class="task-card">
                        <div><strong>{{ update.projectName }}</strong></div>
                        <div style="color: #666; margin: 4px 0;">{{ update.status }}</div>
                        <div style="font-size: 12px; color: #999;">{{ update.updateTime }}</div>
                        <div style="margin-top: 8px;">
                            <span style="background: #e3f2fd; padding: 4px 8px; border-radius: 12px; font-size: 12px;">{{ update.file }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡¹ç›®åˆ—è¡¨é¡µ -->
        <div v-if="currentPage === 'projects'" class="page">
            <div class="header">
                <button @click="navigateTo('home')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>é¡¹ç›®åˆ—è¡¨</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div v-for="project in projects" :key="project.id" class="project-item" @click="toggleProject(project)">
                    <div class="project-header">
                        <div class="project-name">{{ project.name }}</div>
                        <div :class="['project-status', getStatusClass(project.status)]">{{ project.status }}</div>
                    </div>
                    
                    <div v-if="project.expanded" class="project-details">
                        <div style="color: #666; margin: 8px 0;">å®¢æˆ·: {{ project.client }}</div>
                        <div style="color: #666; margin: 8px 0;">è´Ÿè´£äºº: {{ project.manager }}</div>
                        <div style="color: #666; margin: 8px 0;">å¯åŠ¨æ—¶é—´: {{ project.startTime }}</div>
                        <div style="color: #666; margin: 8px 0;">é¢„è®¡å®Œæˆ: {{ project.dueTime }}</div>
                        
                        <div style="margin-top: 16px;">
                            <h4>æœ€è¿‘åŠ¨æ€</h4>
                            <div v-for="update in project.updates" :key="update.id" style="margin: 8px 0; padding: 8px; background: #f9f9f9; border-radius: 4px;">
                                <div style="font-size: 12px; color: #999;">{{ update.time }}</div>
                                <div>{{ update.content }}</div>
                            </div>
                        </div>
                        
                        <button @click="openProjectDetail(project)" class="btn" style="margin-top: 16px;">æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡¹ç›®è¯¦æƒ…é¡µ -->
        <div v-if="currentPage === 'project-detail'" class="page">
            <div class="header">
                <button @click="navigateTo('projects')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>é¡¹ç›®è¯¦æƒ…</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div class="card">
                    <h2>{{ selectedProject.name }}</h2>
                    <div style="color: #0077b6; margin: 8px 0;">{{ selectedProject.status }}</div>
                    <div style="color: #666; font-size: 14px;">
                        å¯åŠ¨: {{ selectedProject.startTime }} | é¢„è®¡: {{ selectedProject.dueTime }}
                    </div>
                    <div style="margin-top: 8px; font-size: 14px;">
                        è´Ÿè´£äºº: {{ selectedProject.manager }} | å®¢æˆ·: {{ selectedProject.client }}
                    </div>
                </div>
                
                <!-- é‡Œç¨‹ç¢‘ -->
                <div class="card">
                    <h3>ğŸ”§ ä¸­è¯•æµç¨‹è¿›åº¦</h3>
                    <div v-for="milestone in selectedProject.milestones" :key="milestone.step" class="milestone-item">
                        <div class="milestone-status" :class="getStatusClass(milestone.status)"></div>
                        <div style="flex: 1;">
                            <div><strong>{{ milestone.step }}</strong></div>
                            <div style="font-size: 12px; color: #666;">{{ milestone.time }}</div>
                        </div>
                        <div v-if="milestone.status === 'in_progress'" style="color: #ff9800;">è¿›è¡Œä¸­</div>
                        <div v-else-if="milestone.status === 'completed'" style="color: #4caf50;">å·²å®Œæˆ</div>
                        <div v-else style="color: #999;">å¾…å¼€å§‹</div>
                    </div>
                </div>
                
                <!-- æ–‡ä»¶ä¸­å¿ƒ -->
                <div class="card">
                    <h3>ğŸ“¦ å…³é”®äº¤ä»˜ç‰©</h3>
                    <div v-for="file in selectedProject.files" :key="file.name" class="file-item">
                        <div class="file-icon">ğŸ“„</div>
                        <div style="flex: 1;">
                            <div><strong>{{ file.name }}</strong></div>
                            <div style="font-size: 12px; color: #666;">{{ file.type }} | {{ file.size }}</div>
                        </div>
                        <button @click="previewFile(file)" class="btn-secondary" style="padding: 4px 12px; font-size: 12px;">é¢„è§ˆ</button>
                    </div>
                </div>
                
                <!-- æ²Ÿé€šè®°å½• -->
                <div class="card">
                    <h3>ğŸ’¬ æ²Ÿé€šè®°å½•</h3>
                    <div v-for="msg in selectedProject.messages" :key="msg.id" class="chat-item">
                        <div class="chat-sender">{{ msg.sender }}</div>
                        <div>{{ msg.content }}</div>
                        <div class="chat-time">{{ msg.time }}</div>
                    </div>
                </div>
                
                <!-- å¾…åŠä»»åŠ¡ -->
                <div v-if="currentUser.role !== 'å®¢æˆ·'" class="card">
                    <h3>â— ä½ éœ€è¦å¤„ç†çš„ä»»åŠ¡</h3>
                    <div v-for="task in selectedProject.tasks" :key="task.id" class="task-card">
                        <div><strong>{{ task.title }}</strong></div>
                        <div style="color: #666; margin: 4px 0;">{{ task.project }}</div>
                        <div style="font-size: 12px; color: #ff9800;">{{ task.dueTime }}</div>
                        <button @click="handleTask(task)" class="btn" style="margin-top: 8px;">{{ task.actionText }}</button>
                    </div>
                </div>
                
                <button v-if="currentUser.role === 'å®¢æˆ·'" @click="navigateTo('approval')" class="btn">æŸ¥çœ‹å¹¶ç¡®è®¤æŠ¥å‘Š</button>
            </div>
        </div>

        <!-- å¾…åŠä»»åŠ¡ä¸­å¿ƒ -->
        <div v-if="currentPage === 'todo'" class="page">
            <div class="header">
                <button @click="navigateTo('home')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>å¾…åŠä»»åŠ¡</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div style="display: flex; overflow-x: auto; margin-bottom: 16px;">
                    <div v-for="tab in todoTabs" :key="tab.key" 
                         :class="['nav-item', { active: activeTodoTab === tab.key }]"
                         @click="activeTodoTab = tab.key"
                         style="white-space: nowrap; padding: 8px 16px;">
                        {{ tab.label }}
                    </div>
                </div>
                
                <div v-for="task in filteredTasks" :key="task.id" class="task-card">
                    <div><strong>{{ task.title }}</strong></div>
                    <div style="color: #666; margin: 4px 0;">é¡¹ç›®: {{ task.project }}</div>
                    <div style="font-size: 12px; color: #ff9800;">æˆªæ­¢: {{ task.dueTime }}</div>
                    <div v-if="task.urgent" style="color: #f44336; font-size: 12px;">âš ï¸ é«˜ä¼˜å…ˆçº§</div>
                    <button @click="handleTask(task)" class="btn" style="margin-top: 8px;">{{ task.actionText }}</button>
                </div>
                
                <!-- æœ¬å‘¨ç»Ÿè®¡ -->
                <div class="card">
                    <h3>ğŸ“Š æœ¬å‘¨ä»»åŠ¡ç»Ÿè®¡</h3>
                    <div style="display: flex; justify-content: space-around;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; color: #4caf50;">âœ…</div>
                            <div>å·²å®Œæˆ: 7é¡¹</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; color: #ff9800;">â³</div>
                            <div>è¿›è¡Œä¸­: 3é¡¹</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; color: #f44336;">âŒ</div>
                            <div>é€¾æœŸ: 0é¡¹</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç”µå­ç­¾æ‰¹æµç¨‹é¡µ -->
        <div v-if="currentPage === 'approval'" class="page">
            <div class="header">
                <button @click="navigateTo('project-detail')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>ç”µå­ç­¾æ‰¹</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div class="card">
                    <h2>ğŸ“„ {{ approvalDocument.title }}</h2>
                    <div style="color: #666; margin: 8px 0;">
                        é¡¹ç›®: {{ approvalDocument.project }}<br>
                        ç±»å‹: {{ approvalDocument.type }}<br>
                        ç”Ÿæˆæ—¶é—´: {{ approvalDocument.time }}
                    </div>
                </div>
                
                <!-- æ–‡ä»¶é¢„è§ˆ -->
                <div class="card">
                    <h3>é¢„è§ˆæ–‡ä»¶</h3>
                    <div style="background: #f0f0f0; height: 300px; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                        <div>ğŸ“„ PDFé¢„è§ˆåŒºåŸŸ</div>
                    </div>
                </div>
                
                <!-- ç­¾æ‰¹æ„è§ -->
                <div class="card">
                    <h3>ç­¾æ‰¹æ„è§</h3>
                    <select v-model="approvalType" class="param-input">
                        <option value="approve">âœ… åŒæ„é€šè¿‡</option>
                        <option value="modify">ğŸ“ éœ€ä¿®æ”¹</option>
                        <option value="reject">âŒ æ‹’ç»</option>
                    </select>
                    
                    <textarea v-if="approvalType !== 'approve'" 
                              v-model="approvalComment" 
                              placeholder="è¯·è¾“å…¥ä¿®æ”¹æ„è§æˆ–æ‹’ç»ç†ç”±" 
                              class="param-input" 
                              rows="3"></textarea>
                </div>
                
                <!-- ç”µå­ç­¾å -->
                <div class="card">
                    <h3>ç”µå­ç­¾å</h3>
                    <div style="margin: 16px 0;">
                        <button @click="currentSignatureMethod = 'hand'" 
                                :class="['btn-secondary', { active: currentSignatureMethod === 'hand' }]"
                                style="margin-right: 8px;">æ‰‹å†™ç­¾å</button>
                        <button @click="currentSignatureMethod = 'bio'" 
                                :class="['btn-secondary', { active: currentSignatureMethod === 'bio' }]"
                                style="margin-right: 8px;">ç”Ÿç‰©è¯†åˆ«</button>
                        <button @click="currentSignatureMethod = 'password'" 
                                :class="['btn-secondary', { active: currentSignatureMethod === 'password' }]"
                                style="margin-right: 8px;">å¯†ç ç¡®è®¤</button>
                    </div>
                    
                    <canvas v-if="currentSignatureMethod === 'hand'" 
                            ref="signatureCanvas" 
                            class="signature-canvas" 
                            @touchstart="startDrawing" 
                            @touchmove="draw" 
                            @touchend="stopDrawing"></canvas>
                    
                    <div v-if="currentSignatureMethod === 'bio'" style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ‘†</div>
                        <div>ä½¿ç”¨æŒ‡çº¹/é¢å®¹è¯†åˆ«å®Œæˆç­¾å</div>
                        <button @click="simulateBioAuth" class="btn" style="margin-top: 16px;">å¼€å§‹éªŒè¯</button>
                    </div>
                </div>
                
                <!-- åˆè§„ç¡®è®¤ -->
                <div class="card">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" v-model="complianceConfirmed" style="margin-right: 8px;">
                        æˆ‘ç¡®è®¤å·²å®Œæ•´å®¡é˜…æ–‡ä»¶å†…å®¹ï¼Œç†è§£ç­¾æ‰¹çš„æ³•å¾‹è´£ä»»
                    </label>
                </div>
                
                <button @click="submitApproval" :disabled="!complianceConfirmed" class="btn">
                    æäº¤ç­¾æ‰¹
                </button>
            </div>
        </div>

        <!-- å·¥è‰ºå‚æ•°å½•å…¥é¡µ -->
        <div v-if="currentPage === 'process-entry'" class="page">
            <div class="header">
                <button @click="navigateTo('todo')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>å‚æ•°å½•å…¥</div>
                <div>{{ currentLocation }}</div>
            </div>
            
            <div style="padding: 16px;">
                <div style="display: flex; overflow-x: auto; margin-bottom: 16px;">
                    <div v-for="(step, index) in processSteps" :key="step.name" 
                         :class="['nav-item', { active: currentStepIndex === index }]"
                         @click="currentStepIndex = index"
                         style="white-space: nowrap; padding: 8px 16px; border: 1px solid #ddd; border-radius: 20px; margin-right: 8px;">
                        {{ step.name }}
                    </div>
                </div>
                
                <div class="card">
                    <h3>{{ processSteps[currentStepIndex].name }} å‚æ•°</h3>
                    
                    <div v-for="param in processSteps[currentStepIndex].params" :key="param.name">
                        <label>{{ param.name }}</label>
                        <div style="display: flex; align-items: center;">
                            <input type="number" 
                                   v-model="param.value" 
                                   :placeholder="param.placeholder" 
                                   class="param-input"
                                   @input="validateParam(param)">
                            <span style="margin-left: 8px;">{{ param.unit }}</span>
                        </div>
                        <div v-if="param.warning" style="color: #f44336; font-size: 12px; margin-top: 4px;">
                            âš ï¸ {{ param.warning }}
                        </div>
                    </div>
                    
                    <textarea v-model="paramRemark" placeholder="å¤‡æ³¨ï¼ˆå¦‚è®¾å¤‡å¼‚å¸¸ã€å‚æ•°è°ƒæ•´åŸå› ç­‰ï¼‰" 
                              class="param-input" rows="3"></textarea>
                </div>
                
                <button @click="submitProcessData" class="btn">æäº¤æ•°æ®</button>
                <button @click="saveDraft" class="btn btn-secondary">æš‚å­˜è‰ç¨¿</button>
            </div>
        </div>

        <!-- æŠ¥å‘Šç”Ÿæˆé¡µ -->
        <div v-if="currentPage === 'report-generation'" class="page">
            <div class="header">
                <button @click="navigateTo('home')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>æŠ¥å‘Šç”Ÿæˆ</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div class="card">
                    <h3>æ•°æ®æºé…ç½®</h3>
                    <div v-for="source in reportDataSources" :key="source.name" style="display: flex; align-items: center; margin: 8px 0;">
                        <input type="checkbox" v-model="source.enabled" :id="source.name">
                        <label :for="source.name" style="margin-left: 8px; flex: 1;">
                            {{ source.name }}
                            <span :style="{ color: source.status === 'complete' ? '#4caf50' : source.status === 'partial' ? '#ff9800' : '#f44336' }">
                                ({{ source.statusText }})
                            </span>
                        </label>
                    </div>
                </div>
                
                <div class="card">
                    <h3>é€‰æ‹©æ¨¡æ¿</h3>
                    <select v-model="selectedTemplate" class="param-input">
                        <option value="nmpa">ğŸ“œ NMPAæ³¨å†Œç”¨ä¸­è¯•æŠ¥å‘Š</option>
                        <option value="fda">ğŸ“œ FDA 510(k) Pre-Market Notification</option>
                        <option value="internal">ğŸ“œ ä¼ä¸šå†…éƒ¨è¯„å®¡æ¨¡æ¿</option>
                    </select>
                </div>
                
                <div class="card">
                    <h3>æŠ¥å‘Šé¢„è§ˆ</h3>
                    <div style="background: #f0f0f0; height: 200px; padding: 16px; border-radius: 8px; overflow-y: auto;">
                        <div><strong>{{ selectedProject.name }} ä¸­è¯•è¯„ä»·æŠ¥å‘Š</strong></div>
                        <div style="margin: 8px 0;">æŠ¥å‘Šç¼–å·: {{ selectedProject.id }}</div>
                        <div style="margin: 8px 0;">ç”Ÿæˆæ—¶é—´: {{ new Date().toLocaleString() }}</div>
                        <div style="font-size: 12px; color: #666;">
                            æ­¤å¤„ä¸ºæŠ¥å‘Šå†…å®¹é¢„è§ˆ...
                        </div>
                    </div>
                </div>
                
                <button @click="generateReport" class="btn">ç”ŸæˆæŠ¥å‘Š</button>
                <button @click="showVersionHistory = true" class="btn btn-secondary">æŸ¥çœ‹ç‰ˆæœ¬å†å²</button>
            </div>
        </div>

        <!-- ç³»ç»Ÿè®¾ç½®é¡µ -->
        <div v-if="currentPage === 'settings'" class="page">
            <div class="header">
                <button @click="navigateTo('home')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>ç³»ç»Ÿè®¾ç½®</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div class="card">
                    <h3>ç»„ç»‡æ¶æ„</h3>
                    <div v-for="dept in departments" :key="dept.name" style="margin: 8px 0;">
                        <div><strong>{{ dept.name }}</strong></div>
                        <div style="font-size: 12px; color: #666;">
                            {{ dept.users.length }} äºº
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>ç”¨æˆ·ç®¡ç†</h3>
                    <div v-for="user in users" :key="user.id" style="display: flex; align-items: center; margin: 8px 0; padding: 8px; border: 1px solid #eee; border-radius: 4px;">
                        <div style="flex: 1;">
                            <div><strong>{{ user.name }}</strong></div>
                            <div style="font-size: 12px; color: #666;">{{ user.role }} | {{ user.department }}</div>
                        </div>
                        <button @click="editUser(user)" class="btn-secondary" style="padding: 4px 12px; font-size: 12px;">ç¼–è¾‘</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>æµç¨‹æ¨¡æ¿ç®¡ç†</h3>
                    <div v-for="template in processTemplates" :key="template.id" style="margin: 8px 0; padding: 8px; border: 1px solid #eee; border-radius: 4px;">
                        <div><strong>{{ template.name }}</strong></div>
                        <div style="font-size: 12px; color: #666;">
                            ç±»å‹: {{ template.type }} | ç‰ˆæœ¬: {{ template.version }} | çŠ¶æ€: {{ template.status }}
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>å®‰å…¨è®¾ç½®</h3>
                    <div style="margin: 8px 0;">
                        <label style="display: flex; align-items: center;">
                            <input type="checkbox" v-model="securitySettings.mfaEnabled">
                            <span style="margin-left: 8px;">å¯ç”¨å¤šå› ç´ è®¤è¯</span>
                        </label>
                    </div>
                    <div style="margin: 8px 0;">
                        <label>ä¼šè¯è¶…æ—¶</label>
                        <select v-model="securitySettings.sessionTimeout" class="param-input">
                            <option value="30">30åˆ†é’Ÿ</option>
                            <option value="60">60åˆ†é’Ÿ</option>
                            <option value="120">2å°æ—¶</option>
                        </select>
                    </div>
                </div>
                
                <button @click="logout" class="btn" style="background: #f44336;">é€€å‡ºç™»å½•</button>
            </div>
        </div>

        <!-- æ–°å»ºä¸­è¯•ç”³è¯·é¡µ -->
        <div v-if="currentPage === 'apply'" class="page">
            <div class="header">
                <button @click="navigateTo('home')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>æ–°å»ºç”³è¯·</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div class="card">
                    <h3>é¡¹ç›®åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="form-group">
                        <label>é¡¹ç›®åç§°</label>
                        <input type="text" v-model="newProject.name" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°" class="param-input">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®ç±»å‹</label>
                        <select v-model="newProject.type" class="param-input">
                            <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                            <option value="æœ‰æºå™¨æ¢°">æœ‰æºå™¨æ¢°</option>
                            <option value="æ— æºå™¨æ¢°">æ— æºå™¨æ¢°</option>
                            <option value="ä½“å¤–è¯Šæ–­">ä½“å¤–è¯Šæ–­</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>é¢„è®¡å‘¨æœŸ</label>
                        <input type="text" v-model="newProject.duration" placeholder="é¢„è®¡ä¸­è¯•å‘¨æœŸï¼ˆå¤©ï¼‰" class="param-input">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®æè¿°</label>
                        <textarea v-model="newProject.description" placeholder="è¯·è¾“å…¥é¡¹ç›®æè¿°" class="param-input" rows="4"></textarea>
                    </div>
                </div>
                
                <button @click="submitNewProject" class="btn">æäº¤ç”³è¯·</button>
            </div>
        </div>

        <!-- æ²Ÿé€šä¸­å¿ƒé¡µ -->
        <div v-if="currentPage === 'messages'" class="page">
            <div class="header">
                <button @click="navigateTo('home')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>æ²Ÿé€šä¸­å¿ƒ</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div style="display: flex; overflow-x: auto; margin-bottom: 16px;">
                    <div v-for="tab in messageTabs" :key="tab.key" 
                         :class="['nav-item', { active: activeMessageTab === tab.key }]"
                         @click="activeMessageTab = tab.key"
                         style="white-space: nowrap; padding: 8px 16px;">
                        {{ tab.label }}
                    </div>
                </div>
                
                <!-- å…¨éƒ¨æ²Ÿé€š -->
                <div v-if="activeMessageTab === 'all'">
                    <div v-for="msg in allMessages" :key="msg.id" class="chat-item">
                        <div style="font-size: 12px; color: #666;">{{ msg.project }}</div>
                        <div class="chat-sender">{{ msg.sender }}</div>
                        <div>{{ msg.content }}</div>
                        <div class="chat-time">{{ msg.time }}</div>
                    </div>
                </div>
                
                <!-- é¡¹ç›®æ²Ÿé€š -->
                <div v-if="activeMessageTab === 'project'">
                    <div v-for="project in projects" :key="project.id" class="card">
                        <div style="font-weight: bold; margin-bottom: 8px;">{{ project.name }}</div>
                        <div v-for="msg in project.messages" :key="msg.id" class="chat-item">
                            <div class="chat-sender">{{ msg.sender }}</div>
                            <div>{{ msg.content }}</div>
                            <div class="chat-time">{{ msg.time }}</div>
                        </div>
                        <div class="message-input">
                            <input v-model="project.newMessage" placeholder="å‘é€æ¶ˆæ¯...">
                            <button @click="sendProjectMessage(project)" class="btn">å‘é€</button>
                        </div>
                    </div>
                </div>
                
                <!-- é€šçŸ¥ä¸­å¿ƒ -->
                <div v-if="activeMessageTab === 'notifications'">
                    <div v-for="notification in notifications" :key="notification.id" style="margin: 8px 0; padding: 8px; border-left: 3px solid #ff9800;">
                        <div style="font-size: 12px; color: #666;">{{ notification.time }}</div>
                        <div>{{ notification.content }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–‡ä»¶ä¸­å¿ƒé¡µ -->
        <div v-if="currentPage === 'files'" class="page">
            <div class="header">
                <button @click="navigateTo('home')" style="background: none; border: none; color: white; font-size: 16px;">â†</button>
                <div>æ–‡ä»¶ä¸­å¿ƒ</div>
                <div></div>
            </div>
            
            <div style="padding: 16px;">
                <div style="display: flex; overflow-x: auto; margin-bottom: 16px;">
                    <div v-for="tab in fileTabs" :key="tab.key" 
                         :class="['nav-item', { active: activeFileTab === tab.key }]"
                         @click="activeFileTab = tab.key"
                         style="white-space: nowrap; padding: 8px 16px;">
                        {{ tab.label }}
                    </div>
                </div>
                
                <div v-for="file in filteredFiles" :key="file.name" class="file-item">
                    <div class="file-icon">ğŸ“„</div>
                    <div style="flex: 1;">
                        <div><strong>{{ file.name }}</strong></div>
                        <div style="font-size: 12px; color: #666;">{{ file.type }} | {{ file.size }} | {{ file.time }}</div>
                    </div>
                    <button @click="previewFile(file)" class="btn-secondary" style="padding: 4px 12px; font-size: 12px;">é¢„è§ˆ</button>
                </div>
            </div>
        </div>

        <!-- ç­¾æ‰¹æˆåŠŸé¡µ -->
        <div v-if="currentPage === 'approval-success'" class="page" style="display: flex; align-items: center; justify-content: center;">
            <div style="text-align: center; padding: 32px;">
                <div style="font-size: 64px; color: #4caf50; margin-bottom: 16px;">âœ…</div>
                <h2>ç­¾æ‰¹æˆåŠŸï¼</h2>
                <p style="color: #666; margin: 16px 0;">æ‚¨çš„ç­¾åå·²è®°å½•ï¼Œç›¸å…³æ–¹å°†æ”¶åˆ°é€šçŸ¥</p>
                <button @click="navigateTo('project-detail')" class="btn">è¿”å›é¡¹ç›®è¯¦æƒ…</button>
            </div>
        </div>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <div v-if="['home', 'projects', 'messages', 'profile'].includes(currentPage)" class="footer-nav">
            <div class="nav-item" :class="{ active: currentPage === 'home' }" @click="navigateTo('home')">
                ğŸ  é¦–é¡µ
            </div>
            <div class="nav-item" :class="{ active: currentPage === 'projects' }" @click="navigateTo('projects')">
                ğŸ“‹ é¡¹ç›®
            </div>
            <div class="nav-item" :class="{ active: currentPage === 'messages' }" @click="navigateTo('messages')">
                ğŸ’¬ æ²Ÿé€š
            </div>
            <div class="nav-item" :class="{ active: currentPage === 'profile' }" @click="navigateTo('settings')">
                ğŸ“ æˆ‘çš„
            </div>
        </div>

        <!-- Toast æç¤º -->
        <div class="toast" :style="{ display: showToast ? 'block' : 'none' }">
            {{ toastMessage }}
        </div>
    </div>

    <script>
        // å½“å‰é¡µé¢
        let currentPage = 'login';
        
        // ç™»å½•ç›¸å…³
        let loginTab = 'client';
        let loginForm = {
            username: 'manager001', // é¢„å¡«é»˜è®¤å€¼
            password: '123456',     // é¢„å¡«é»˜è®¤å€¼
            role: 'é¡¹ç›®ç»ç†'        // é¢„å¡«é»˜è®¤å€¼
        };
        
        // å½“å‰ç”¨æˆ·ä¿¡æ¯
        let currentUser = {
            name: 'å¼ ç»ç†',
            role: 'é¡¹ç›®ç»ç†',
            id: 'PM001'
        };
        
        // ä¸åŒè§’è‰²çš„å¿«æ·å…¥å£é…ç½®
        const roleQuickEntries = {
            'å®¢æˆ·': [
                { id: 1, icon: 'ğŸ“Š', text: 'æˆ‘çš„é¡¹ç›®', page: 'projects', enabled: true },
                { id: 2, icon: 'âœ…', text: 'å¾…æˆ‘å®¡æ‰¹', page: 'todo', enabled: true },
                { id: 3, icon: 'ğŸ’¬', text: 'æ²Ÿé€šä¸­å¿ƒ', page: 'messages', enabled: true },
                { id: 4, icon: 'ğŸ“', text: 'æ–‡ä»¶ä¸­å¿ƒ', page: 'files', enabled: true },
                { id: 5, icon: 'ğŸ“‹', text: 'æŠ¥å‘Šç”Ÿæˆ', page: 'report-generation', enabled: false },
                { id: 6, icon: 'ğŸ”§', text: 'å‚æ•°å½•å…¥', page: 'process-entry', enabled: false },
                { id: 7, icon: 'âœ…', text: 'ä»»åŠ¡ä¸­å¿ƒ', page: 'todo', enabled: true },
                { id: 8, icon: 'ğŸ“', text: 'æˆ‘çš„è®¾ç½®', page: 'settings', enabled: true }
            ],
            'é¡¹ç›®ç»ç†': [
                { id: 1, icon: 'ğŸ“„', text: 'æ–°å»ºç”³è¯·', page: 'apply', enabled: true },
                { id: 2, icon: 'ğŸ“Š', text: 'æˆ‘çš„é¡¹ç›®', page: 'projects', enabled: true },
                { id: 3, icon: 'âœ…', text: 'å¾…æˆ‘å®¡æ‰¹', page: 'todo', enabled: true },
                { id: 4, icon: 'ğŸ’¬', text: 'æ²Ÿé€šä¸­å¿ƒ', page: 'messages', enabled: true },
                { id: 5, icon: 'ğŸ“', text: 'æ–‡ä»¶ä¸­å¿ƒ', page: 'files', enabled: true },
                { id: 6, icon: 'ğŸ“‹', text: 'æŠ¥å‘Šç”Ÿæˆ', page: 'report-generation', enabled: true },
                { id: 7, icon: 'âœ…', text: 'ä»»åŠ¡ä¸­å¿ƒ', page: 'todo', enabled: true },
                { id: 8, icon: 'ğŸ“', text: 'æˆ‘çš„è®¾ç½®', page: 'settings', enabled: true }
            ],
            'ä¸­è¯•å·¥ç¨‹å¸ˆ': [
                { id: 1, icon: 'ğŸ“Š', text: 'æˆ‘çš„é¡¹ç›®', page: 'projects', enabled: true },
                { id: 2, icon: 'âœ…', text: 'å¾…æˆ‘å®¡æ‰¹', page: 'todo', enabled: true },
                { id: 3, icon: 'ğŸ“‹', text: 'å‚æ•°å½•å…¥', page: 'process-entry', enabled: true },
                { id: 4, icon: 'ğŸ’¬', text: 'æ²Ÿé€šä¸­å¿ƒ', page: 'messages', enabled: true },
                { id: 5, icon: 'ğŸ“', text: 'æ–‡ä»¶ä¸­å¿ƒ', page: 'files', enabled: true },
                { id: 6, icon: 'ğŸ“‹', text: 'æŠ¥å‘Šç”Ÿæˆ', page: 'report-generation', enabled: false },
                { id: 7, icon: 'âœ…', text: 'ä»»åŠ¡ä¸­å¿ƒ', page: 'todo', enabled: true },
                { id: 8, icon: 'ğŸ“', text: 'æˆ‘çš„è®¾ç½®', page: 'settings', enabled: true }
            ],
            'æ£€æµ‹å·¥ç¨‹å¸ˆ': [
                { id: 1, icon: 'ğŸ“Š', text: 'æˆ‘çš„é¡¹ç›®', page: 'projects', enabled: true },
                { id: 2, icon: 'âœ…', text: 'å¾…æˆ‘å®¡æ‰¹', page: 'todo', enabled: true },
                { id: 3, icon: 'ğŸ“‹', text: 'å‚æ•°å½•å…¥', page: 'process-entry', enabled: true },
                { id: 4, icon: 'ğŸ’¬', text: 'æ²Ÿé€šä¸­å¿ƒ', page: 'messages', enabled: true },
                { id: 5, icon: 'ğŸ“', text: 'æ–‡ä»¶ä¸­å¿ƒ', page: 'files', enabled: true },
                { id: 6, icon: 'ğŸ“‹', text: 'æŠ¥å‘Šç”Ÿæˆ', page: 'report-generation', enabled: false },
                { id: 7, icon: 'âœ…', text: 'ä»»åŠ¡ä¸­å¿ƒ', page: 'todo', enabled: true },
                { id: 8, icon: 'ğŸ“', text: 'æˆ‘çš„è®¾ç½®', page: 'settings', enabled: true }
            ],
            'è´¨é‡å®¡æ ¸å‘˜': [
                { id: 1, icon: 'ğŸ“Š', text: 'æˆ‘çš„é¡¹ç›®', page: 'projects', enabled: true },
                { id: 2, icon: 'âœ…', text: 'å¾…æˆ‘å®¡æ‰¹', page: 'todo', enabled: true },
                { id: 3, icon: 'ğŸ“‹', text: 'å‚æ•°å½•å…¥', page: 'process-entry', enabled: false },
                { id: 4, icon: 'ğŸ’¬', text: 'æ²Ÿé€šä¸­å¿ƒ', page: 'messages', enabled: true },
                { id: 5, icon: 'ğŸ“', text: 'æ–‡ä»¶ä¸­å¿ƒ', page: 'files', enabled: true },
                { id: 6, icon: 'ğŸ“‹', text: 'æŠ¥å‘Šç”Ÿæˆ', page: 'report-generation', enabled: false },
                { id: 7, icon: 'âœ…', text: 'ä»»åŠ¡ä¸­å¿ƒ', page: 'todo', enabled: true },
                { id: 8, icon: 'ğŸ“', text: 'æˆ‘çš„è®¾ç½®', page: 'settings', enabled: true }
            ],
            'å¹³å°ç®¡ç†å‘˜': [
                { id: 1, icon: 'ğŸ“Š', text: 'æˆ‘çš„é¡¹ç›®', page: 'projects', enabled: true },
                { id: 2, icon: 'âœ…', text: 'å¾…æˆ‘å®¡æ‰¹', page: 'todo', enabled: true },
                { id: 3, icon: 'ğŸ“‹', text: 'å‚æ•°å½•å…¥', page: 'process-entry', enabled: true },
                { id: 4, icon: 'ğŸ’¬', text: 'æ²Ÿé€šä¸­å¿ƒ', page: 'messages', enabled: true },
                { id: 5, icon: 'ğŸ“', text: 'æ–‡ä»¶ä¸­å¿ƒ', page: 'files', enabled: true },
                { id: 6, icon: 'ğŸ“‹', text: 'æŠ¥å‘Šç”Ÿæˆ', page: 'report-generation', enabled: true },
                { id: 7, icon: 'âœ…', text: 'ä»»åŠ¡ä¸­å¿ƒ', page: 'todo', enabled: true },
                { id: 8, icon: 'ğŸ“', text: 'æˆ‘çš„è®¾ç½®', page: 'settings', enabled: true }
            ]
        };
        
        // æ ¹æ®å½“å‰è§’è‰²è·å–å¯¹åº”çš„å¿«æ·å…¥å£
        function getQuickEntries() {
            return roleQuickEntries[currentUser.role] || roleQuickEntries['é¡¹ç›®ç»ç†'];
        }
        
        // é¡¹ç›®åˆ—è¡¨
        let projects = [
            {
                id: '2025-MD08',
                name: 'å¿ƒè„èµ·æå™¨ä¸­è¯•',
                status: 'è¿›è¡Œä¸­',
                client: 'æç»ç†',
                manager: 'å¼ å·¥',
                startTime: '2025-10-15',
                dueTime: '2025-11-30',
                expanded: false,
                newMessage: '',
                updates: [
                    { id: 1, content: 'å·¥è‰ºéªŒè¯å®Œæˆ', time: '2025-11-24 15:30' },
                    { id: 2, content: 'è¯•åˆ¶æ‰§è¡Œé˜¶æ®µ', time: '2025-11-10 10:20' }
                ],
                messages: [
                    { id: 'msg1', sender: 'ç‹å·¥', content: 'ä»Šå¤©å®Œæˆäº†åŠ é€Ÿè€åŒ–è¯•éªŒï¼Œæ•°æ®æ­£å¸¸', time: '14:22' },
                    { id: 'msg2', sender: 'ç³»ç»Ÿ', content: 'ã€ŠéªŒè¯æŠ¥å‘Šã€‹å·²æäº¤è‡³å®¡æ ¸é˜Ÿåˆ—', time: '10:15' },
                    { id: 'msg3', sender: 'å¼ ç»ç†', content: 'åŒæ„è¿›å…¥æŠ¥å‘Šç¼–åˆ¶é˜¶æ®µ', time: '16:40' }
                ],
                milestones: [
                    { step: 'éœ€æ±‚ç¡®è®¤', status: 'completed', time: '2025-10-16' },
                    { step: 'å·¥è‰ºè®¾è®¡', status: 'completed', time: '2025-10-20' },
                    { step: 'è¯•åˆ¶æ‰§è¡Œ', status: 'completed', time: '2025-11-10' },
                    { step: 'æ£€æµ‹éªŒè¯', status: 'completed', time: '2025-11-20' },
                    { step: 'æŠ¥å‘Šç¼–åˆ¶', status: 'in_progress', time: 'è¿›è¡Œä¸­', progress: 70 },
                    { step: 'å®¢æˆ·ç¡®è®¤', status: 'pending', time: 'å¾…è§¦å‘' },
                    { step: 'é¡¹ç›®ç»“æ¡ˆ', status: 'pending', time: 'å¾…è§¦å‘' }
                ],
                files: [
                    { name: 'ä¸­è¯•å·¥è‰ºæ–¹æ¡ˆV1.2.pdf', type: 'æ–¹æ¡ˆ', size: '2.3MB', time: '2025-10-20' },
                    { name: 'ç”µå­æ‰¹è®°å½•-Batch#3.xlsx', type: 'è®°å½•', size: '1.1MB', time: '2025-11-15' },
                    { name: 'æ£€æµ‹æŠ¥å‘ŠMD08-V3.pdf', type: 'æŠ¥å‘Š', size: '4.2MB', time: '2025-11-22' },
                    { name: 'ä¸­è¯•è¯„ä»·æŠ¥å‘ŠV1.0.pdf', type: 'æŠ¥å‘Š', size: '5.6MB', time: '2025-11-24' }
                ],
                tasks: [
                    {
                        id: 'task1',
                        title: 'å®¡æ ¸æ£€æµ‹åŸå§‹æ•°æ®',
                        project: '2025-MD08',
                        dueTime: '2025-11-26 20:00',
                        actionText: 'å‰å¾€å®¡æ ¸'
                    }
                ]
            },
            {
                id: '2025-MD12',
                name: 'è¡€ç³–ä»ªå¤–å£³æ³¨å¡‘',
                status: 'å·²å®Œæˆ',
                client: 'ç‹ç»ç†',
                manager: 'æå·¥',
                startTime: '2025-09-01',
                dueTime: '2025-10-31',
                expanded: false,
                newMessage: '',
                updates: [
                    { id: 1, content: 'é¡¹ç›®ç»“æ¡ˆ', time: '2025-11-20 16:45' },
                    { id: 2, content: 'å®¢æˆ·ç¡®è®¤æŠ¥å‘Š', time: '2025-11-18 14:30' }
                ],
                messages: [
                    { id: 'msg1', sender: 'èµµå·¥', content: 'æ³¨å¡‘å·¥è‰ºå‚æ•°ä¼˜åŒ–å®Œæˆ', time: '09:15' },
                    { id: 'msg2', sender: 'åˆ˜å®¡æ ¸', content: 'è´¨é‡æ£€æµ‹æŠ¥å‘Šå·²å®¡æ ¸é€šè¿‡', time: '11:20' }
                ],
                milestones: [
                    { step: 'éœ€æ±‚ç¡®è®¤', status: 'completed', time: '2025-09-02' },
                    { step: 'å·¥è‰ºè®¾è®¡', status: 'completed', time: '2025-09-08' },
                    { step: 'è¯•åˆ¶æ‰§è¡Œ', status: 'completed', time: '2025-10-05' },
                    { step: 'æ£€æµ‹éªŒè¯', status: 'completed', time: '2025-10-15' },
                    { step: 'æŠ¥å‘Šç¼–åˆ¶', status: 'completed', time: '2025-10-20' },
                    { step: 'å®¢æˆ·ç¡®è®¤', status: 'completed', time: '2025-10-25' },
                    { step: 'é¡¹ç›®ç»“æ¡ˆ', status: 'completed', time: '2025-10-31' }
                ],
                files: [
                    { name: 'æ³¨å¡‘å·¥è‰ºæ–¹æ¡ˆV1.0.pdf', type: 'æ–¹æ¡ˆ', size: '1.8MB', time: '2025-09-10' },
                    { name: 'æ‰¹è®°å½•-æ³¨å¡‘æ‰¹æ¬¡.xlsx', type: 'è®°å½•', size: '900KB', time: '2025-10-10' },
                    { name: 'æ£€æµ‹æŠ¥å‘ŠMD12-V1.pdf', type: 'æŠ¥å‘Š', size: '3.5MB', time: '2025-10-18' }
                ],
                tasks: []
            },
            {
                id: '2025-MD15',
                name: 'ä¸€æ¬¡æ€§å¯¼ç®¡ä¸­è¯•',
                status: 'è¿›è¡Œä¸­',
                client: 'é™ˆç»ç†',
                manager: 'å­™å·¥',
                startTime: '2025-11-01',
                dueTime: '2025-12-15',
                expanded: false,
                newMessage: '',
                updates: [
                    { id: 1, content: 'éœ€æ±‚ç¡®è®¤å®Œæˆ', time: '2025-11-05 10:30' },
                    { id: 2, content: 'å·¥è‰ºè®¾è®¡ä¸­', time: '2025-11-10 14:15' }
                ],
                messages: [
                    { id: 'msg1', sender: 'å­™å·¥', content: 'ææ–™é€‰å‹ç¡®è®¤å®Œæˆ', time: '15:45' },
                    { id: 'msg2', sender: 'å®¢æˆ·', content: 'å¸Œæœ›å¢åŠ ç”Ÿç‰©ç›¸å®¹æ€§æµ‹è¯•', time: '16:20' }
                ],
                milestones: [
                    { step: 'éœ€æ±‚ç¡®è®¤', status: 'completed', time: '2025-11-05' },
                    { step: 'å·¥è‰ºè®¾è®¡', status: 'in_progress', time: 'è¿›è¡Œä¸­', progress: 60 },
                    { step: 'è¯•åˆ¶æ‰§è¡Œ', status: 'pending', time: 'å¾…è§¦å‘' },
                    { step: 'æ£€æµ‹éªŒè¯', status: 'pending', time: 'å¾…è§¦å‘' },
                    { step: 'æŠ¥å‘Šç¼–åˆ¶', status: 'pending', time: 'å¾…è§¦å‘' },
                    { step: 'å®¢æˆ·ç¡®è®¤', status: 'pending', time: 'å¾…è§¦å‘' },
                    { step: 'é¡¹ç›®ç»“æ¡ˆ', status: 'pending', time: 'å¾…è§¦å‘' }
                ],
                files: [
                    { name: 'æŠ€æœ¯åè®®V1.0.pdf', type: 'åè®®', size: '1.2MB', time: '2025-11-03' },
                    { name: 'ææ–™æµ‹è¯•æŠ¥å‘ŠV1.pdf', type: 'æŠ¥å‘Š', size: '2.1MB', time: '2025-11-08' }
                ],
                tasks: [
                    {
                        id: 'task1',
                        title: 'å®Œæˆå·¥è‰ºè®¾è®¡',
                        project: '2025-MD15',
                        dueTime: '2025-11-15 18:00',
                        actionText: 'ç»§ç»­è®¾è®¡'
                    }
                ]
            }
        ];
        
        // é€‰ä¸­çš„é¡¹ç›®
        let selectedProject = projects[0];
        
        // æ¼”ç¤ºæ•°æ®
        let todoCount = 3;
        let projectUpdates = [
            {
                id: 'update1',
                projectName: 'å¿ƒè„èµ·æå™¨ä¸­è¯•',
                status: 'å·¥è‰ºéªŒè¯å®Œæˆ',
                file: 'éªŒè¯æŠ¥å‘ŠV1.2',
                updateTime: '2025-11-24 15:30'
            },
            {
                id: 'update2',
                projectName: 'è¡€ç³–ä»ªå¤–å£³æ³¨å¡‘',
                status: 'è¯•åˆ¶æ‰§è¡Œä¸­',
                file: 'æ‰¹è®°å½•V3.1',
                updateTime: '2025-11-24 14:20'
            },
            {
                id: 'update3',
                projectName: 'ä¸€æ¬¡æ€§å¯¼ç®¡ä¸­è¯•',
                status: 'éœ€æ±‚ç¡®è®¤å®Œæˆ',
                file: 'æŠ€æœ¯åè®®V1.0',
                updateTime: '2025-11-23 16:45'
            }
        ];
        
        // å¾…åŠä»»åŠ¡
        let todoTasks = [
            {
                id: 'T20251124001',
                type: 'approval',
                title: 'éœ€å®¢æˆ·ç¡®è®¤ã€Šä¸­è¯•è¯„ä»·æŠ¥å‘Šã€‹',
                project: '2025-MD08',
                dueTime: '2025-11-26 18:00',
                urgent: true,
                attachments: ['report_v1.pdf'],
                actionText: 'æŸ¥çœ‹å¹¶ç¡®è®¤',
                action: 'approval'
            },
            {
                id: 'T20251124002',
                type: 'process',
                title: 'ç¬¬4æ‰¹è¯•åˆ¶å‚æ•°å½•å…¥',
                project: '2025-MD12',
                dueTime: '2025-11-25 14:00',
                urgent: false,
                attachments: [],
                actionText: 'å¼€å§‹å½•å…¥',
                action: 'process-entry'
            },
            {
                id: 'T20251124003',
                type: 'review',
                title: 'æ£€æµ‹åŸå§‹æ•°æ®å®¡æ ¸',
                project: '2025-MD08',
                dueTime: '2025-11-25 20:00',
                urgent: true,
                attachments: ['data.xlsx'],
                actionText: 'å‰å¾€å®¡æ ¸',
                action: 'process-entry'
            }
        ];
        
        let activeTodoTab = 'all';
        let todoTabs = [
            { key: 'urgent', label: 'ğŸ”´ é«˜ä¼˜å…ˆçº§' },
            { key: 'approval', label: 'â³ å¾…å®¡æ‰¹' },
            { key: 'process', label: 'ğŸ“‹ å¾…å½•å…¥' },
            { key: 'all', label: 'âœ… å…¨éƒ¨' }
        ];
        
        function getFilteredTasks() {
            if (activeTodoTab === 'all') return todoTasks;
            if (activeTodoTab === 'urgent') return todoTasks.filter(t => t.urgent);
            return todoTasks.filter(t => t.type === activeTodoTab);
        }
        
        // ç”µå­ç­¾æ‰¹ç›¸å…³
        let approvalDocument = {
            title: 'ä¸­è¯•è¯„ä»·æŠ¥å‘ŠV1.0',
            project: '2025-MD08',
            type: 'æœ€ç»ˆäº¤ä»˜æŠ¥å‘Š',
            time: '2025-11-24 16:30'
        };
        
        let approvalType = 'approve';
        let approvalComment = '';
        let currentSignatureMethod = 'hand';
        let complianceConfirmed = false;
        let signatureCanvas = null;
        let isDrawing = false;
        
        // å·¥è‰ºå‚æ•°å½•å…¥
        let currentLocation = 'ç»„è£…è½¦é—´-å·¥ä½03';
        let processSteps = [
            {
                name: 'é¢„å¤„ç†',
                params: [
                    { name: 'æ¸©åº¦', value: '', placeholder: 'è¾“å…¥æ¸©åº¦', unit: 'Â°C', min: 20, max: 25, warning: '' },
                    { name: 'æ¹¿åº¦', value: '', placeholder: 'è¾“å…¥æ¹¿åº¦', unit: '%', min: 45, max: 65, warning: '' }
                ]
            },
            {
                name: 'ç»„è£…',
                params: [
                    { name: 'å‹åŠ›', value: '', placeholder: 'è¾“å…¥å‹åŠ›', unit: 'kPa', min: 100, max: 120, warning: '' },
                    { name: 'æŒç»­æ—¶é—´', value: '', placeholder: 'è¾“å…¥æ—¶é—´', unit: 'min', min: 10, max: 20, warning: '' }
                ]
            },
            {
                name: 'è€åŒ–æµ‹è¯•',
                params: [
                    { name: 'æ¸©åº¦', value: '', placeholder: 'è¾“å…¥æ¸©åº¦', unit: 'Â°C', min: 40, max: 50, warning: '' },
                    { name: 'æ—¶é—´', value: '', placeholder: 'è¾“å…¥æ—¶é—´', unit: 'h', min: 24, max: 168, warning: '' }
                ]
            }
        ];
        let currentStepIndex = 0;
        let paramRemark = '';
        
        // æŠ¥å‘Šç”Ÿæˆ
        let reportDataSources = [
            { name: 'å·¥è‰ºæ•°æ®', enabled: true, status: 'complete', statusText: 'å®Œæ•´' },
            { name: 'æ£€æµ‹ç»“æœ', enabled: true, status: 'partial', statusText: 'éƒ¨åˆ†ç¼ºå¤±' },
            { name: 'ç”µå­ç­¾æ‰¹', enabled: false, status: 'pending', statusText: 'å¾…å®Œæˆ' },
            { name: 'è®¾å¤‡æ—¥å¿—', enabled: true, status: 'complete', statusText: 'å®Œæ•´' }
        ];
        let selectedTemplate = 'nmpa';
        let showVersionHistory = false;
        
        // ç³»ç»Ÿè®¾ç½®
        let departments = [
            { name: 'å¹³å°ç®¡ç†éƒ¨', users: ['å¼ ç»ç†', 'æä¸»ç®¡'] },
            { name: 'ä¸­è¯•å·¥ç¨‹éƒ¨', users: ['ç‹å·¥', 'èµµå·¥', 'å­™å·¥'] },
            { name: 'è´¨é‡å®¡æ ¸ç»„', users: ['åˆ˜å®¡æ ¸', 'é™ˆå®¡æ ¸'] }
        ];
        let users = [
            { id: 'PM001', name: 'å¼ ç»ç†', role: 'é¡¹ç›®ç»ç†', department: 'å¹³å°ç®¡ç†éƒ¨' },
            { id: 'EN001', name: 'ç‹å·¥', role: 'ä¸­è¯•å·¥ç¨‹å¸ˆ', department: 'ä¸­è¯•å·¥ç¨‹éƒ¨' },
            { id: 'QA001', name: 'åˆ˜å®¡æ ¸', role: 'è´¨é‡å®¡æ ¸å‘˜', department: 'è´¨é‡å®¡æ ¸ç»„' }
        ];
        let processTemplates = [
            { id: 'temp1', name: 'å¿ƒè„èµ·æå™¨ä¸­è¯•æµç¨‹', type: 'æœ‰æºå™¨æ¢°', version: 'V2.1', status: 'å¯ç”¨' },
            { id: 'temp2', name: 'è¡€ç³–ä»ªæ³¨å¡‘ä¸­è¯•æµç¨‹', type: 'æ— æºå™¨æ¢°', version: 'V1.3', status: 'å¯ç”¨' },
            { id: 'temp3', name: 'ä¸€æ¬¡æ€§å¯¼ç®¡ä¸­è¯•æµç¨‹', type: 'ä¸‰ç±»å™¨æ¢°', version: 'V3.0', status: 'è‰ç¨¿' }
        ];
        let securitySettings = {
            mfaEnabled: true,
            sessionTimeout: '30'
        };
        
        // æ–°å»ºé¡¹ç›®
        let newProject = {
            name: '',
            type: '',
            duration: '',
            description: ''
        };
        
        // æ²Ÿé€šä¸­å¿ƒ
        let messageTabs = [
            { key: 'all', label: 'å…¨éƒ¨æ²Ÿé€š' },
            { key: 'project', label: 'é¡¹ç›®æ²Ÿé€š' },
            { key: 'notifications', label: 'é€šçŸ¥ä¸­å¿ƒ' }
        ];
        let activeMessageTab = 'all';
        let allMessages = [
            { id: 1, project: 'å¿ƒè„èµ·æå™¨ä¸­è¯•', sender: 'å¼ ç»ç†', content: 'å¤§å®¶å¥½ï¼Œä»Šå¤©å¼€å§‹å¿ƒè„èµ·æå™¨ä¸­è¯•é¡¹ç›®', time: '10:30' },
            { id: 2, project: 'è¡€ç³–ä»ªå¤–å£³æ³¨å¡‘', sender: 'èµµå·¥', content: 'æ³¨å¡‘å·¥è‰ºå‚æ•°ä¼˜åŒ–å®Œæˆ', time: '09:15' },
            { id: 3, project: 'ä¸€æ¬¡æ€§å¯¼ç®¡ä¸­è¯•', sender: 'å­™å·¥', content: 'ææ–™é€‰å‹ç¡®è®¤å®Œæˆ', time: '15:45' },
            { id: 4, project: 'å¿ƒè„èµ·æå™¨ä¸­è¯•', sender: 'ç‹å·¥', content: 'ä»Šå¤©å®Œæˆäº†åŠ é€Ÿè€åŒ–è¯•éªŒï¼Œæ•°æ®æ­£å¸¸', time: '14:22' }
        ];
        let notifications = [
            { id: 1, content: 'ã€ŠéªŒè¯æŠ¥å‘Šã€‹å·²ç”Ÿæˆï¼Œè¯·å®¡æ ¸', time: '14:20' },
            { id: 2, content: 'æ–°ä»»åŠ¡ï¼šå‚æ•°å½•å…¥ - ç¬¬4æ‰¹', time: '11:15' }
        ];
        
        // æ–‡ä»¶ä¸­å¿ƒ
        let allFiles = [
            { name: 'ä¸­è¯•å·¥è‰ºæ–¹æ¡ˆV1.2.pdf', type: 'æ–¹æ¡ˆ', size: '2.3MB', time: '2025-10-20', category: 'æ–¹æ¡ˆ', project: '2025-MD08' },
            { name: 'ç”µå­æ‰¹è®°å½•-Batch#3.xlsx', type: 'è®°å½•', size: '1.1MB', time: '2025-11-15', category: 'è®°å½•', project: '2025-MD08' },
            { name: 'æ£€æµ‹æŠ¥å‘ŠMD08-V3.pdf', type: 'æŠ¥å‘Š', size: '4.2MB', time: '2025-11-22', category: 'æŠ¥å‘Š', project: '2025-MD08' },
            { name: 'ä¸­è¯•è¯„ä»·æŠ¥å‘ŠV1.0.pdf', type: 'æŠ¥å‘Š', size: '5.6MB', time: '2025-11-24', category: 'æŠ¥å‘Š', project: '2025-MD08' },
            { name: 'æ³¨å¡‘å·¥è‰ºæ–¹æ¡ˆV1.0.pdf', type: 'æ–¹æ¡ˆ', size: '1.8MB', time: '2025-09-10', category: 'æ–¹æ¡ˆ', project: '2025-MD12' },
            { name: 'æ‰¹è®°å½•-æ³¨å¡‘æ‰¹æ¬¡.xlsx', type: 'è®°å½•', size: '900KB', time: '2025-10-10', category: 'è®°å½•', project: '2025-MD12' },
            { name: 'æ£€æµ‹æŠ¥å‘ŠMD12-V1.pdf', type: 'æŠ¥å‘Š', size: '3.5MB', time: '2025-10-18', category: 'æŠ¥å‘Š', project: '2025-MD12' },
            { name: 'æŠ€æœ¯åè®®V1.0.pdf', type: 'åè®®', size: '1.2MB', time: '2025-11-03', category: 'åè®®', project: '2025-MD15' },
            { name: 'ææ–™æµ‹è¯•æŠ¥å‘ŠV1.pdf', type: 'æŠ¥å‘Š', size: '2.1MB', time: '2025-11-08', category: 'æŠ¥å‘Š', project: '2025-MD15' }
        ];
        let activeFileTab = 'all';
        let fileTabs = [
            { key: 'all', label: 'å…¨éƒ¨' },
            { key: 'æ–¹æ¡ˆ', label: 'æ–¹æ¡ˆ' },
            { key: 'è®°å½•', label: 'è®°å½•' },
            { key: 'æŠ¥å‘Š', label: 'æŠ¥å‘Š' },
            { key: 'SOP', label: 'SOP' }
        ];
        
        function getFilteredFiles() {
            if (activeFileTab === 'all') return allFiles;
            return allFiles.filter(file => file.category === activeFileTab);
        }
        
        // Toast æç¤º
        let showToast = false;
        let toastMessage = '';
        
        // æ–¹æ³•
        function login() {
            if (!loginForm.username || !loginForm.password) {
                showToast = true;
                toastMessage = 'è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ';
                setTimeout(() => { showToast = false; }, 2000);
                return;
            }
            
            if (loginTab === 'internal' && !loginForm.role) {
                showToast = true;
                toastMessage = 'è¯·é€‰æ‹©è§’è‰²';
                setTimeout(() => { showToast = false; }, 2000);
                return;
            }
            
            // æ¨¡æ‹Ÿç™»å½•æˆåŠŸ
            currentUser.name = loginForm.username;
            currentUser.role = loginTab === 'client' ? 'å®¢æˆ·' : loginForm.role;
            
            showToast = true;
            toastMessage = 'ç™»å½•æˆåŠŸï¼';
            setTimeout(() => { 
                showToast = false;
                currentPage = 'home';
                updateUI();
            }, 2000);
        }
        
        function navigateTo(page) {
            // æ£€æŸ¥è§’è‰²æƒé™
            if (page === 'process-entry' && ['å®¢æˆ·', 'è´¨é‡å®¡æ ¸å‘˜'].includes(currentUser.role)) {
                showNoPermission();
                return;
            }
            if (page === 'report-generation' && ['å®¢æˆ·', 'ä¸­è¯•å·¥ç¨‹å¸ˆ', 'æ£€æµ‹å·¥ç¨‹å¸ˆ', 'è´¨é‡å®¡æ ¸å‘˜'].includes(currentUser.role)) {
                showNoPermission();
                return;
            }
            
            currentPage = page;
            showToast = false;
            updateUI();
        }
        
        function showNoPermission() {
            showToast = true;
            toastMessage = 'æ‚¨æ²¡æœ‰æƒé™è®¿é—®æ­¤åŠŸèƒ½';
            setTimeout(() => { showToast = false; }, 2000);
        }
        
        function getStatusClass(status) {
            if (status === 'è¿›è¡Œä¸­' || status === 'in_progress') return 'status-progress';
            if (status === 'å·²å®Œæˆ' || status === 'completed') return 'status-completed';
            return 'status-pending';
        }
        
        function toggleProject(project) {
            project.expanded = !project.expanded;
            updateUI();
        }
        
        function openProjectDetail(project) {
            selectedProject = project;
            currentPage = 'project-detail';
            updateUI();
        }
        
        function handleTask(task) {
            if (task.action) {
                navigateTo(task.action);
            } else {
                showToast = true;
                toastMessage = 'åŠŸèƒ½å¼€å‘ä¸­...';
                setTimeout(() => { showToast = false; }, 2000);
            }
        }
        
        function previewFile(file) {
            showToast = true;
            toastMessage = `é¢„è§ˆæ–‡ä»¶: ${file.name}`;
            setTimeout(() => { showToast = false; }, 2000);
        }
        
        function startDrawing(e) {
            isDrawing = true;
            const canvas = document.querySelector('.signature-canvas');
            const ctx = canvas.getContext('2d');
            ctx.beginPath();
            const rect = canvas.getBoundingClientRect();
            ctx.moveTo(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
        }
        
        function draw(e) {
            if (!isDrawing) return;
            const canvas = document.querySelector('.signature-canvas');
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top);
            ctx.stroke();
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        function simulateBioAuth() {
            showToast = true;
            toastMessage = 'ç”Ÿç‰©è¯†åˆ«éªŒè¯æˆåŠŸï¼';
            setTimeout(() => { 
                showToast = false;
                currentSignatureMethod = 'bio';
            }, 2000);
        }
        
        function submitApproval() {
            if (!complianceConfirmed) {
                showToast = true;
                toastMessage = 'è¯·ç¡®è®¤æ³•å¾‹è´£ä»»æ¡æ¬¾';
                setTimeout(() => { showToast = false; }, 2000);
                return;
            }
            
            showToast = true;
            toastMessage = 'ç­¾æ‰¹æäº¤æˆåŠŸï¼';
            setTimeout(() => { 
                showToast = false;
                currentPage = 'approval-success';
                updateUI();
            }, 2000);
        }
        
        function validateParam(param) {
            const value = parseFloat(param.value);
            if (value < param.min || value > param.max) {
                param.warning = `è¶…å‡ºèŒƒå›´ (${param.min}-${param.max}${param.unit})`;
            } else {
                param.warning = '';
            }
        }
        
        function submitProcessData() {
            // éªŒè¯æ‰€æœ‰å‚æ•°
            let hasError = false;
            processSteps[currentStepIndex].params.forEach(param => {
                if (param.warning) hasError = true;
            });
            
            if (hasError) {
                showToast = true;
                toastMessage = 'å­˜åœ¨å‚æ•°å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥åæäº¤';
                setTimeout(() => { showToast = false; }, 2000);
                return;
            }
            
            showToast = true;
            toastMessage = 'å‚æ•°æäº¤æˆåŠŸï¼';
            setTimeout(() => { 
                showToast = false;
                currentPage = 'home';
                updateUI();
            }, 2000);
        }
        
        function saveDraft() {
            showToast = true;
            toastMessage = 'è‰ç¨¿å·²ä¿å­˜åˆ°æœ¬åœ°';
            setTimeout(() => { showToast = false; }, 2000);
        }
        
        function generateReport() {
            showToast = true;
            toastMessage = 'æŠ¥å‘Šç”Ÿæˆä¸­...';
            setTimeout(() => { 
                showToast = false;
                currentPage = 'home';
                updateUI();
            }, 2000);
        }
        
        function editUser(user) {
            showToast = true;
            toastMessage = `ç¼–è¾‘ç”¨æˆ·: ${user.name}`;
            setTimeout(() => { showToast = false; }, 2000);
        }
        
        function logout() {
            showToast = true;
            toastMessage = 'é€€å‡ºç™»å½•æˆåŠŸ';
            setTimeout(() => { 
                showToast = false;
                currentPage = 'login';
                loginForm = { username: 'manager001', password: '123456', role: 'é¡¹ç›®ç»ç†' };
                updateUI();
            }, 2000);
        }
        
        function submitNewProject() {
            if (!newProject.name || !newProject.type) {
                showToast = true;
                toastMessage = 'è¯·å¡«å†™é¡¹ç›®åç§°å’Œç±»å‹';
                setTimeout(() => { showToast = false; }, 2000);
                return;
            }
            
            showToast = true;
            toastMessage = 'ç”³è¯·æäº¤æˆåŠŸï¼';
            setTimeout(() => { 
                showToast = false;
                currentPage = 'home';
                updateUI();
            }, 2000);
        }
        
        function sendProjectMessage(project) {
            if (!project.newMessage.trim()) {
                showToast = true;
                toastMessage = 'è¯·è¾“å…¥æ¶ˆæ¯å†…å®¹';
                setTimeout(() => { showToast = false; }, 2000);
                return;
            }
            
            project.messages.push({
                id: project.messages.length + 1,
                sender: currentUser.name,
                content: project.newMessage,
                time: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
            });
            
            // åŒæ—¶æ·»åŠ åˆ°å…¨å±€æ¶ˆæ¯åˆ—è¡¨
            allMessages.unshift({
                id: allMessages.length + 1,
                project: project.name,
                sender: currentUser.name,
                content: project.newMessage,
                time: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
            });
            
            project.newMessage = '';
            showToast = true;
            toastMessage = 'æ¶ˆæ¯å‘é€æˆåŠŸï¼';
            setTimeout(() => { showToast = false; }, 2000);
        }
        
        // æ›´æ–°UIå‡½æ•°
        function updateUI() {
            const app = document.getElementById('app');
            app.innerHTML = app.innerHTML; // é‡æ–°æ¸²æŸ“é¡µé¢
        }
        
        // åˆå§‹åŒ–ç”»å¸ƒ
        function initCanvas() {
            const canvas = document.querySelector('.signature-canvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#000';
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            updateUI();
            initCanvas();
        });
        
        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            initCanvas();
        });
    </script>
</body>
</html>